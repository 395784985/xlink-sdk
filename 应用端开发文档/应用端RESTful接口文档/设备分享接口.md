# 用户设备分享接口

* 通过调用该系列接口，用户可以完成对设备的分享管理，以及接收和拒绝分享请求等相关功能。


## 接口概览

1. [设备分享](#device_share)
2. [取消分享](#device_share_cancel)
3. [接受分享](#accept_share)
4. [拒绝分享](#deny_share)
5. [获取设备分享列表](#share_list)
6. [删除设备分享记录](#delete_share)

## 接口详情

### **<a name="device_share">1.设备分享</a>**

	用户可以将设备分享给其他用户，与其他用户共同拥有设备，共同控制设备，分享设备的用户为设备的管理者，被分享者为设备的普通用户。
    只有设备的管理者才可分享设备给其他用户

#### ***设备分享流程：***
    
    1.设备管理者向其他用户发出设备分享
    2.系统产生一则设备分享记录到设备管理者和被分享用户的消息列表中，消息将在一定时间后失效。
    3.被分享用户这从消息列表获知这一则设备分享消息，可选择【接受】或【拒绝】别人分享的设备。
    4.设备管理者可用在被分享用户【接受】或【拒绝】之前可以【取消】分享这个分享设备的消息，此时分享记录即被设为失效。
    5.被分享用户【接受】了分享，与设备管理者共同拥有这一个分享的设备。



##### ***设备分享的方式有三种：***

* 通过用户ID进行分享
* 二维码分享
* 邮件方式分享


##### ***关于设备管理者***

    用户通过SDK连接云智易服务器并成功订阅设备才能是设备管理者。
    用户手动注册一个新的设备并成为设备管理


**Request**


URL

    POST /v2/share/device

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    {
        "device_id" : 设备ID,
        "user" : "用户帐号",
        "expire" : 7200,
        "mode" : "分享方式"
    }


字段 | 是否必须 | 描述
---- | ---- | ----
device_id | 是 | 所要分享的设备ID
user | 否 | 分享给谁；在进行二维码或者邮箱分享的时候，对方ID不确定，只需拿到分享码即可。可以为对方手机号或者邮箱号。
expire | 是 | 分享请求有效时间，单位秒
mode | 是 | 分享方式，枚举值，见[附录](#share_mode)

**Response**

Header

    HTTP/1.1 200 OK

Content

    {
    "invite_code" : "分享ID"
    }


### **<a name="device_share_cancel">2.取消分享</a>**



    设备管理者可以在分享发出以后，通过本接口将分享取消。


**Request**

URL

    POST /v2/share/device/cancel

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    {
        "invite_code" : "分享ID",
    }

**Response**

Header

    HTTP/1.1 200 OK

Content

    无


 
### **<a name="accept_share">3.接受分享</a>**


    用户接受设备分享者的分享。

**Requeset**

URL

    POST /v2/share/device/accept

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    {
    "invite_code" : "分享ID"
    }

**Response**

Header

    HTTP/1.1 200 OK

Content

    无



### **<a name="deny_share">4.拒绝分享</a>**


    用户拒绝设备分享的分享

**Request**

URL

    POST /v2/share/device/deny

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    {
        "invite_code" : "分享ID",
        "reason":"用户拒绝分享的原因"
    }


字段 | 是否必须 | 描述
---- | ---- | ----
invite_code | 是 | 分享ID
reason | 否 | 用户拒绝分享的原因

**Response**

Header

    HTTP/1.1 200 OK

Content

    无



### **<a name="share_list">5.获取设备分享列表</a>**


    管理者和用户可以查询所有和自己有关的设备分享列表，包括管理者分享出去的和其他管理者分享给我的。

**Request**

URL

    GET /v2/share/device/list

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content
    无

**Response**

Header

    HTTP/1.1 200 OK

Content

    [
        {
            "invite_code" : 分享邀请码,
            "from_id" : 分享者ID,
            "from_user" : 分享者帐号,
            "to_id" : 被分享者ID,
            "to_user" : 被分享者帐号,
            "device_id" : 设备ID,
            "state" : 分享状态
            "create_date" : 分享记录产生时间，例：2015-10-09T08 : 15 : 40.843Z
            "expire_date" : 分享记录过期时间，例：2015-10-09T08 : 15 : 40.843Z
        },
    ]
    
字段 | 是否必须 | 描述
---- | ---- | ----
invite_code | 是 | 分享ID
from_id | 是 | 分享者ID，一般都是设备管理员的ID。
from_user | 是 | 分享者帐号，一般都是设备管理员的ID。
to_id | 是 | 分享给谁
to_user | 是 | 分享给谁的帐号
device_id | 是 | 设备ID
state | 是 | 分享状态;见[附录](#share_status)
create_date | 是 | 分享记录产生时间，例：2015-10-09T08 : 15 : 40.843Z
expire_date | 是 | 分享记录过期时间，例：2015-10-09T08 : 15 : 40.843Z


### **<a name="delete_share">6.删除设备分享记录</a>**

    用户或者管理者删除分享记录。
    
**Request**

URL

    DELETE /v2/share/device/delete/{invite_code}
Header
    
    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    无

**Response**

Header

    HTTP/1.1 200 OK

Content

    无

### **附录** 

**<a name="share_mode">分享方式</a>**

枚举值|说明
---- | ---- 
app | app方式分享
qrcode | 二维码方式分享
email | 邮件方式分享
    

**<a name="share_status">分享状态</a>**

枚举值|说明
---- | ---- 
pending | 等待接受
accept | 已接受
deny | 已拒绝
cancel | 分享被撤销
overtime | 已过期



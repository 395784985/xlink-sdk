# 用户身份接口

    用户可通过手机或者邮箱在云智易平台下注册成为一个云智易用户。
    通过账号和密码进行认证获得一个有效的调用凭证，即可通过调用凭证使用云智易用户相关的RESTful接口。


## **接口概览**

1. 使用邮箱注册新账号
2. 激活邮箱账号
3. 使用手机注册新账号
4. 发送手机验证码
5. 登录与认证
6. 刷新凭证
7. 获取用户详细信息
8. 修改用户信息
9. 修改密码
10. 找回密码
11. 附录

## **接口详情**

### ***关于企业ID说明:***

    用户的注册、认证、找回密码等接口都需要提供有效的企业ID，企业用户可登陆云智易管理台获取企业ID

### **1.使用邮箱注册新账号**
    用户可提供邮箱注册为一个云智易用户，注册后系统会发一封激活邮件到用户的邮箱中，用户可通过点击邮箱链接进行激活。
    关于邮箱激活，企业可在云智易管理台中设置用户的注册选项，可以指定用户是否需要激活才允许认证通过，默认是需要激活才可认证通过。



**Request**

URL

    POST /v2/user_register

Header

    Content-Type : "application/json"

Content

    {
        "email":"邮箱地址",
        "nickname":"昵称",
        "corp_id":"企业ID",
        "password":"认证密码",
        "source":"用户来源",
        "local_lang":"本地语言代码"
    }    

**Response**

Header

    HTTP/1.1 200 OK

Content

    {
        "email":"邮箱地址"
    }


字段 | 是否必须 | 描述
---- | -------- | ----
email | 是 | 邮箱地址
nickname | 是 | 用户昵称，长度2-32个字符
corp_id | 是 | 企业ID
password | 是 | 认证密码，长度6-16个字符
source | 是 | 用户来源，见附录
local_lang | 否 | 本地语言代码，默认：zh-ch，见附录



### **2.激活邮箱账号**

**Request**

URL

    POST /v2/user_email_activate

Header

    HTTP/1.1 200 OK

Content

    {
        "corp_id":"企业ID",
        "verifycode":"验证码",
        "email":"邮箱地址"
    }

**Response**

Header

    HTTP/1.1 200 OK

Content

    无

### **3.使用手机注册新账号**

    通过手机验证码正确的手机验证码注册成为云智易用户。
    调用本接口时需要事先通过发送手机验证码获得一个有效的验证码。
    注：仅支持中国，若是中国以外的用户，请使用邮箱注册用户。

**Request**

URL

    POST /v2/user_register

Header

    Content-Type : "application/json"
Content

    {
    "phone":"手机号码",
    "nickname":"昵称",
    "corp_id":"企业ID",
    "verifycode":"验证码",
    "password":"登录密码",
    "source":"用户来源",
    "local_lang":"本地语言代码"
    }


**Response**

Header

    HTTP/1.1 200 OK

Content

    {
        "phone":"手机号码"
    }

| 字段 | 是否必须 | 描述
| -- | -- | --
| phone | 是 | 手机号
| nickname | 是 | 用户昵称，长度2-32个字符
| corp_id | 是 | 企业ID
| verifycode | 是 | 手机短信验证码
| password | 是 | 认证密码，长度6-16个字符
| source | 是 | 用户来源，见附录
| local_lang | 否 | 本地语言代码，默认：zh-ch，见附录


### **4.发送手机验证码**
    调用本接口向用户注册的手机号发送验证码。通过验证码即可完成用户的注册，手机验证码有效期是120秒。

**Request**

URL

    POST /v2/user_register/verifycode
Header

    "Content-Type":"application/json"

Content

    {
    "corp_id":"企业ID",
    "phone":"手机号"
    }

**Response**

Header

    HTTP/1.1 200 OK
Content

    无



### **5.登录与认证**

    登陆与认证是用户通过账号（邮箱或者手机号）和密码获取云智易RESTful接口调用凭证的方式，成功认证后会获得一个有效的调用凭证和一个有效的刷新凭证。
    调用凭证有效期为2个小时。



**Request**

URL

    POST /v2/user_auth

Header

    "Content-Type":"application/json"

Content

    {
        "corp_id":"企业ID",
        "phone/email" : "手机号码/邮箱",
        "password" : "登录密码"
    }


| 字段 | 是否必须 | 描述
| -- | -- | --
| corpId |  是| 企业ID
| phone/email | 是 | 邮箱或者手机（根据用户注册的方式）
| password | 是 | 密码

**Response**

Header

    HTTP/1.1 200 OK

Content

    {
        "user_id":"用户ID",
        "access_token":"调用凭证",
        "refresh_token":"刷新凭证",
        "expire_in":"有效期（秒）"
    }


| 字段 | 是否必须 | 描述
| -- | -- | --
| user_id | 是 | 用户ID
| access_token | 是 | 云智易RESTful接口调用凭证
| refresh_token | 是 | 刷新凭证，可用于刷新一个新的调用凭证
| expire_in| 是 | 调用凭证的有效时长


### **6.刷新凭证**

        用户认证获取的调用凭证有效时长只有2个小时，开发者可以通过
    本接口刷新一个新的调用凭证和一个新的刷新凭证，若在调用凭证已经
    过期，则无法刷新凭证，只能重新认证。


**Request**

URL

    POST /v2/user/token/refresh
Header

    Content-Type:"application/json"
    Access-Token:调用凭证

Content

    {
        "refresh_token":"刷新凭证"
    }


**Response**

Header

    HTTP/1.1 200 OK

Content

    {
        "access_token":"新的调用凭证",
        "refresh_token":"新的刷新凭证",
        "expire_in":"有效期"
    }


### **7.获取用户详细信息**

    可以通过本接口获取详细的用户个人的详细信息

**Request**

URL

    GET /v2/user/{user_id}

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    无

**Response**

Header

    HTTP/1.1 200 OK

Content

    {
        "id" : "用户ID",
        "corp_id":"企业ID",
        "phone/email" : "手机号/邮箱",
        "nickname" : "用户昵称",
        "authorize_code":"认证码",
        "create_date" : "创建时间",
        "status":"用户状态",
        "source" : "用户来源",
        "region_id":"所在区域ID",
        "is_vaild":"用户账号是否已认证"
    }

| 字段 | 是否必须 | 描述
|-- | -- | --
| id | 是 | 用户ID
| corp_id | 是 | 企业ID
| phone/email | 是 | 手机号/邮箱
| nickname | 是 | 用户昵称
| authorize_code | 是 | 用户认证码
| create_date | 是 | 用户注册时间，如:2015-10-09T08:15:40.843Z
| status | 是 | 用户状态，见附录
| source | 是 | 用户来源，见附录
| region_id | 是 | 所在区域ID
| is_vaild | 是 | 账号是否已激活


### **8.修改用户基本信息**

    修改用户基本信息，目前仅可修改用户昵称


**Request**

URL

    PUT /v2/user/{user_id}

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    {
        "nickname" : "用户昵称"
    }

**Response**

Header

    HTTP/1.1 200 OK

Content

    无


### **9.修改密码**

    修改用户的密码

**Request**

URL

    PUT /v2/user/password/reset

Header

    Content-Type : "application/json"
    Access-Token : "调用凭证"

Content

    {
        "old_password" : "旧密码",
        "new_password" : "新密码"
    }

**Response**

Header

    HTTP/1.1 200 OK

Content

    无


### **10.找回密码**

    找回密码是在用户忘记密码或者丢失密码的时候，用户通过账号（手机或邮箱）进行密码重置。
    注：用户的账号需要已激活才可通过账号(手机或邮箱)找回密码。


 **流程如下：**


![](zhao_hui_mi_ma.jpg)



    云智易提供默认的找回密码邮件模板和默认的重置密码页面，在云智易管理台自定义找回密码邮件模板和重置密码页面链接，只需要在邮件模板指定参数即可。


| 邮件参数 | 说明 |
|-- |--|
|%verifycode% |验证码 |
|%corp_id% | 企业ID |
|%email% | 邮箱地址 |



** 请求密码找回 **

    通过账号发起一个密码找回的请求。
    如果是邮箱注册用户，将会发送一份密码找回邮件到用户邮箱中，由用户点击邮件中的链接进入重置密码页面进行密码重置。
    如果是手机注册用户，将会发送一则带有6位数字的验证码的短信到用户手机，用户通过验证码进行密码重置。


**Request**

URL

    POST /v2/user/password/forgot

Header

    Content-Type : "application/json"

Content

    {
        "corp_id":"企业ID",
        "phone/email":"手机号码/邮箱地址"
    }

**Response**

Header

    HTTP/1.1 200 OK

Content

    无


** 通过验证码重置密码 **

    根据用户注册类型发一封邮件或者一则短信到用户的邮箱或手机中。用户通过验证码可重置密码。


** Request **

URL

    POST /v2/user/password/foundback
Header

    Content-Type : "application/json"

Content

    {
        "corp_id":"企业ID",
        "phone/email" : "手机号码/邮箱地址",
        "verifycode" : "验证码",
        "new_password" : "新的密码"
    }

| 字段 | 是否必须 | 描述
| -- | -- | --
| corp_id | 是 | 企业ID
| phone/email | 是 | 邮箱或手机
| verifycode | 是 | 验证码
| new_password | 是 | 新的密码

**Response**

Header

    HTTP/1.1 200 OK
Content

    无


### **11.附录**

**用户来源**

|枚举值| 说明 |
|-- | -- |
|1 | Web|
|2 | Android客户端
|3 | IOS客户端
|4 | 微信用户
|5 | QQ用户
|10| 其它遵循xlink统一身份认证规范的用户来源


**用户状态**

|枚举值| 说明 |
|-- | -- |
|1 | 正常可用状态
|2 | 停用状态 |



**本地语言代码**

| 枚举值 | 说明 |
| -- | -- |
|zh-cn| 中文（简体）
|en-us| 英语（美国）

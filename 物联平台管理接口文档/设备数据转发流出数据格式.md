# 设备数据转发流出数据说明

	设备上下线/激活/发送pipe包/发送sync包时会在xlink平台产生产生事件,在第三方平台设置了针对这些事件的转发规则后,xlink平台会将这些事件涉及的数据以相应的数据消息格式转发至第三方平台,针对涉及的数据消息格式进行一下说明。


#**数据消息格式预览**

	所有的消息格式均以json标准格式转发出。

1. [STATE消息](#state)
2. [ACTIVATION消息](#active)
3. [PIPE/PIPE_SYNC消息](#pipe)
4. [SYNC消息](#sync)


#**数据消息详情**


###**<a name="state">1.STATE消息</a>**

	设备在上下线时, xlink平台会根据数据转发设置中的配置, 以 STATE消息 格式转发至配置中的url。


**触发场景**

	设备上线或者下线。


**消息格式**

	{
	    "type": "消息type",
	    "time": "消息time",
	    "product_id": "消息product_id",
	    "ip": "消息ip",
	    "id": "消息id",
	    "msg_id": "消息msgid",
	    "state": "消息状态"
	}


**格式说明**

字段 | 是否必须 | 描述
---- | ---- | ----
id |是 | 设备标识, 设备ID:device_id
time | 是 | 设备上下线时间, yyyy-MM-dd HH:mm:ss.SS
product_id | 是 | 设备所属产品标识, 产品ID
state | 是 | STATE消息的类型,取值：online或offline
msg_id | 是 | xlink平台自定义的消息ID
type | 是 | 均为STATE
ip | 是 | 设备上下线的ip地址


###**<a name="active">2.ACTIVATION消息</a>**

	在激活设备时, xlink平台会根据数据转发设置中的配置, 以 ACTIVATION消息 格式转发至配置中的url。


**触发场景**
	
	设备被激活。


**消息格式**

	{
	    "type": "消息type",
	    "time": "消息time",
	    "product_id": "消息product_id",
	    "id": "消息id",
	    "ip": "消息ip",
	    "msg_id": "消息msgid"
	}


**格式说明**

字段 | 是否必须 | 描述
---- | ---- | ----
type | 是 | 均为ACTIVATION
time | 是 | 设备激活时间, yyyy-MM-dd HH:mm:ss.SS
product_id | 是 | 设备所属产品标识, 产品ID
id |是 | 设备标识, 设备ID:device_id
ip | 是 | 设备激活的ip地址
msg_id | 是 | xlink平台自定义的消息ID



###**<a name="pipe">3.PIPE/PIPE_SYNC消息</a>**

	在设备或者用户发射PIPE包时, xlink平台会根据数据转发设置中的配置, 以 PIPE/PIPE_SYNC消息 格式转发至配置中的url。


**触发场景**
	
	设备或者用户发射PIPE包。


**消息格式**

	{
	    "type": "消息type",
	    "time": "消息time",
	    "product_id": "消息product_id",
	    "from_id": "消息from_id",
	    "to_id": "消息to_id",
	    "msg_id": "消息msg_id",
	    "data": "消息data"
	}
	

**格式说明**

字段 | 是否必须 | 描述
---- | ---- | ----
type | 是 | 均为PIPE
time | 是 | 设备激活时间, yyyy-MM-dd HH:mm:ss.SS
product_id | 是 | 设备所属产品标识, 产品ID
from_id | 是 | 数据发送方id
to_id | 是 | 数据接收方id
msg_id | 是 | xlink平台自定义的消息ID
data | 是 | pipe包中的数据


###**<a name="sync">4.SYNC消息</a>**

	在设备同步数据端点数据时, xlink平台会根据数据转发设置中的配置, 以 SYNC消息 格式转发至配置。

**触发场景**
	
	设备同步数据端点数据。

**消息格式**

	{
	    "type": "消息type",
	    "time": "消息time",
	    "product_id": "消息product_id",
	    "from_id": "消息from_id",
	    "msg_id": "消息msg_id",
		"datapoint":[
			{
		         "index": 0,
		         "type": "bool/byte/short/int/string",
		         "value": "xxxx"
	     	}
		]
	}

**格式说明**

字段 | 是否必须 | 描述
---- | ---- | ----
type | 是 | 均为SYNC
time | 是 | 设备激活时间, yyyy-MM-dd HH:mm:ss.SS
product_id | 是 | 设备所属产品标识, 产品ID
from_id | 是 | 产生数据的设备ID, device_id
msg_id | 是 | xlink平台自定义的消息ID
datapoint | 是 | sync包数据,列表形式
datapoint.index | 是 | sync包数据下标
datapoint.type | 是 | sync包数据类型,有如下bool/byte/short/int/string
datapoint.value | 是 | sync包数据值
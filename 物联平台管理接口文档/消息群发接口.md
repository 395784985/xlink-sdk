©2016  **云智易**物联云平台（http://www.xlink.cn）

# 消息群发接口

	本文档用于设置消息群发接口说明。

# **接口概览**
1. [及时消息群发](#BroadcastImmediately)
2. [消息群发任务列表](#UserPushTaskHistory)
3. [附录](#appendix)


# **接口详情**


### **<a name="BroadcastImmediately">1.及时消息群发</a>**

	在后台产生群发任务后,立即发送,若用户不在线则等到用户上线时再次重发。

**Request**

URL

	POST /v2/broadcast/immediately

Header

	Content-Type:"application/json"

Content

	{
		"title":"标题",
		"content":"推送内容",
		"expired_time":"过期时间",
		"msg_type":"消息类型",
		"dest_type":"消息目标类型",
		"tags":["标签1","标签2"],
		"user_ids":[userId, userId],
		"action_type":"动作类型",
		"url":"点击时指向地址",
		"command":"点击时动作指令"
	}

字段 | 是否必须 | 描述
---- | ---- | ----
title | 是 | 消息标题
content | 是 | 消息内容
expired_time | 是 | 过期时间,yyyy-MM-dd'T'HH:mm:ss.SS'Z'
msg_type | 是 | 消息文本类型, 见[附录](#msg_type)
dest_type | 是 | 消息目标类型, 见[附录](#dest_type)
tags | 否 | 用户标签,多个标签时是与关系,dest_type为2时才有
user_ids | 否 | 用户id,dest_type为3时才有
action_type | 是 | 消息动作类型,见[附录](#action_type)
url | 否 | 用户点击时打开url, action_type为1才有
command | 否 | 用户点击时执行动作命令, action_type为2才有

**Response**

Header

	HTTP/1.1 200 OK

Content
	
	无


### **<a name="UserPushTaskHistory">2.消息群发任务列表</a>**

	查询消息群发的历史列表

**Request**

URL

	POST /v2/broadcast_history

Header

	Content-Type:"application/json"

Content

		{
	    "offset": "请求列表的偏移量",
	    "limit": "请求数量",
	    "filter": [
	        "字段A",
	        "字段B"
	    ],
	    "query": {
	        "filed1": {
	            "$in": [
	                "字段值",
	                "字段值"
	            ]
	        },
	        "filed3": {
	            "$lt": "字段值"
	        }
	    },
	    "order": {
	        "filed1": "desc",
	        "filed2": "asc"
	    }
	}

字段 | 是否必须 | 描述
---- | ---- | ----
offset | 否	| 从某个偏移量开始请求，默认为0
limit |否 | 请求的条目数量，默认为10
filter |否 | 字段过滤，可以指定返回结果列表的字段
order |否 |	可以指定通过用户默认字段排序，desc降序，asc升序
query |否 | 查询条件，可以根据不同字段加上不同的比较指令来查<br>询，查询条件字段包含用户默认属性，不包含用户扩展<br>属性，支持比较指令包含如下： <br>$in：包含于该列表任意一个值 <br>$lt：小于该字段值 <br>$lte：小于或等于字段值<br>$gt：大于该字段值<br> $gte：大于或等于该字段值

**Response**

Header

	HTTP/1.1 200 OK

Content
	
	{
	    "count": 1,
	    "list": [
	        {
	            "id": "57883bbc053c217679f2f754",
	            "title": "军事行动",
	            "content": "立即行动快速",
	            "dest_type": 2,
	            "msg_type": 1,
	            "action_type": 2,
	            "create_time": "2016-07-15T09:26:18.876Z",
	            "expired_time": "2016-07-15T09:24:15.70Z",
	            "status": 1,
	            "tags": [
	                "程序员"
	            ],
	            "users": [],
	            "url": "",
	            "command": "执行行动"
	        }
	    ]
	}

字段 | 是否必须 | 描述
---- | ---- | ----
id	 | 是 | 消息群发ID
title | 是 | 消息主题
content | 是 | 消息内容
dest_type | 是 | 消息目标类型, 见[附录](#dest_type)
msg_type | 是 | 消息文本类型, 见[附录](#msg_type)
action_type | 是 | 消息动作类型,见[附录](#action_type)
create_time | 是 | 创建时间, yyyy-MM-dd'T'HH:mm:ss.SS'Z'
expired_time | 是 | 过期时间, yyyy-MM-dd'T'HH:mm:ss.SS'Z'
status | 是 | 消息状态,见[附录](#status)
tags | 否 | dest_type为2时, 标识用户标签
users | 否 | dest_type为3时, 标识指定用户
url | 否 | action_type为1时, 点击消息打开的链接地址
command | 否 | action_type为2时, 点击消息执行的命令

## **<a name="appendix">附录</a>**

<a name="msg_type">**消息文本类型**</a>

枚举值 | 说明
---- | ----
1 | Txt文本

<a name="dest_type">**消息目标类型**</a>

枚举值 | 说明
---- | ----
1 | 企业下所有用户,All
2 | 企业下标签用户,Tags
3 | 企业下指定用户,Users

<a name="action_type">**消息动作类型**</a>

枚举值 | 说明
---- | ----
1 | 用户点击时打开,url
2 | 用户点击时执行动作,command

<a name="status">**消息任务状态类型**</a>

枚举值 | 说明
---- | ----
1 | Pushed, 已发送